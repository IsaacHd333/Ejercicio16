<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversor de Monedas</title>
</head>

<body>

    <h1>Conversor de Pesos Mexicanos</h1>

    <!-- Entrada de cantidad en pesos -->
    <label>Cantidad en pesos mexicanos:</label>
    <input type="number" id="pesosInput"><br><br>

    <!-- Radio buttons fijos -->
    <label><input type="radio" name="moneda" value="USD"> Dólar (USD)</label><br>
    <label><input type="radio" name="moneda" value="EURO"> Euro (EUR)</label><br>
    <label><input type="radio" name="moneda" value="JPY"> Yen (JPY)</label><br><br>

    <!-- Botón para convertir -->
    <button onclick="convertir()">Convertir</button>

    <!-- Donde se muestran los tipos de cambio -->
    <h2>Tipos de cambio actuales</h2>
    <p id="demo">Cargando...</p>

    <!-- Resultado final -->
    <h2>Resultado de la conversión</h2>
    <p id="resultado"></p>

    <script>
        // Variable global donde se guardan los datos obtenidos del servidor
        let datos = [];

        // Función asincrónica que obtiene el archivo desde el servidor
        async function getFile() {

            // Se crea una promesa que realiza la solicitud HTTP
            let myPromise = new Promise(function (resolve) {

                // Se crea el objeto para la petición
                let req = new XMLHttpRequest();
                req.open("GET", "http://18.222.133.113/ejercicio16/index.php");

                // Si la solicitud se carga correctamente
                req.onload = function () {
                    if (req.status == 200) {
                        // Convierte el texto JSON en un arreglo de objetos
                        datos = JSON.parse(req.responseText);

                        // Crea texto para mostrar los tipos de cambio
                        let texto = "";
                        for (let i = 0; i < datos.length; i++) {
                            texto += `${datos[i].moneda}: ${datos[i].valor}<br>`;
                        }

                        // Devuelve el texto generado
                        resolve(texto);
                    } else {
                        resolve("No se pudo obtener el archivo.");
                    }
                };

                // Si ocurre un error en la conexión
                req.onerror = function () {
                    resolve("Error de conexión con el servidor.");
                };

                // Envía la solicitud
                req.send();
            });

            // Espera el resultado de la promesa y lo muestra en el elemento con id "demo"
            document.getElementById("demo").innerHTML = await myPromise;
        }

        // Función que realiza la conversión
        function convertir() {
            let pesos = parseFloat(document.getElementById("pesosInput").value);
            let seleccion = document.querySelector('input[name="moneda"]:checked');
            let resultado = document.getElementById("resultado");

            // Verifica que se haya ingresado una cantidad válida
            if (isNaN(pesos) || pesos <= 0) {
                resultado.innerHTML = "Ingresa una cantidad válida.";
                return;
            }

            // Verifica que se haya seleccionado una moneda
            if (!seleccion) {
                resultado.innerHTML = "Selecciona una moneda.";
                return;
            }

            // Si los datos no están cargados aún
            if (datos.length === 0) {
                resultado.innerHTML = "Los datos aún no se han cargado.";
                return;
            }

            // Busca la moneda seleccionada dentro del arreglo de datos
            let moneda = datos.find(m => m.moneda === seleccion.value);

            // Si no encuentra la moneda, muestra un mensaje
            if (!moneda) {
                resultado.innerHTML = "No se encontró el tipo de cambio.";
                return;
            }

            // Calcula la conversión
            let total = (pesos / moneda.valor).toFixed(2);

            // Muestra el resultado
            resultado.innerHTML = ${pesos} pesos mexicanos = ${total} ${moneda.moneda};
        }

        // Llama a la función cuando se carga la página
        getFile();
    </script>

</body>
</html>